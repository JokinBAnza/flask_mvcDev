{% extends "base.html" %}

{% block title %}Listado de Socios{% endblock %}

{% block content %}
<div style="padding-bottom: 100px;">
    <h1>Listado de Socios</h1>

    <div style="margin-bottom: 20px;">
        <button onclick="location.href='{{ url_for('socios.crear_socio_vista') }}'" style="padding: 10px 20px;">
            Crear nuevo socio
        </button>
    </div>

    <!-- FORMULARIO DE BÚSQUEDA Y FILTRO -->
    <form method="GET" action="{{ url_for('socios.listar_socios') }}" style="margin-bottom: 20px; display:flex; gap:10px; align-items:center;">
        <input type="text" name="q" placeholder="Buscar por nombre o email" value="{{ request.args.get('q', '') }}" style="padding:5px;">
        <label>
            <input type="checkbox" name="prestamo" value="1" {% if request.args.get('prestamo') %}checked{% endif %}>
            Solo socios con libro prestado
        </label>
        <button type="submit" class="btn-accion">Filtrar</button>
    </form>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <ul>
            {% for category, message in messages %}
                <li class="{{ category }}">{{ message }}</li>
            {% endfor %}
            </ul>
        {% endif %}
    {% endwith %}

    {% if socios %}
    <table style="width:100%; border-collapse: collapse; margin-bottom: 20px;">
        <thead>
            <tr style="background-color: #f0f0f0;">
                <th style="padding: 10px; border: 1px solid #ccc;">ID</th>
                <th style="padding: 10px; border: 1px solid #ccc;">Nombre</th>
                <th style="padding: 10px; border: 1px solid #ccc;">Email</th>
                <th style="padding: 10px; border: 1px solid #ccc;">Acciones</th>
            </tr>
        </thead>
        <tbody>
        {% for socio in socios %}
        <tr>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ socio.id }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ socio.nombre }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ socio.email }}</td>
            <td style="padding: 10px; border: 1px solid #ccc; text-align:center; vertical-align:middle;">
                <button onclick="location.href='{{ url_for('socios.editar_socio_vista', socio_id=socio.id) }}'" class="btn-accion">
                    Editar
                </button>

                <form method="POST" action="{{ url_for('socios.borrar_socio_vista', socio_id=socio.id) }}">
                    <button type="submit" class="btn-borrar" onclick="return confirm('¿Seguro que quieres borrar este socio?');">
                        Borrar
                    </button>
                </form>
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p>No hay socios registrados.</p>
    {% endif %}
</div>
{% endblock %}
